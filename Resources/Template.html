<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1 plus MathML 2.0//EN"
	"http://www.w3.org/TR/MathML2/dtd/xhtml-math11-f.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta name="Author" content="Gerd Knops" />
		<style type="text/css">
			body {
				background-color: white;
				background-attachment: fixed;
				font: 12px "Monaco", "Courier New", monospace;
				font-style: normal;
				font-weight: normal;
			}
			a {
			}
			a:hover {
				background-color: #dddddd;
			}
			span.SyslogError {
				color: Crimson;
			}
			span.SyslogWarning {
				color: Chocolate;
			}
			span.ApLoSearchHighlight {
			    background: LightGray;
			    border: 1px solid black;
			    -webkit-border-radius: 3px;
			}
			span.ApLoSearchSelected {
			    background: yellow;
			    border: 1px solid black;
			    -webkit-border-radius: 3px;
			}
		</style>
		<script type="text/javascript">
			
			var ApLoMatches=new Array();
			var ApLoSelectedMatch=null;
			
			function ApLoHighlightString(searchString)
			{
			    ApLoRemoveHighlights();
			    ApLoAddHighlights(document.body,searchString.toLowerCase());
				
				return ApLoMatches.length;
			}
			function ApLoRemoveHighlights()
			{
				apLoSetSelectedMatch(null);
			    ApLoRemoveHighlightsIn(document.body);
				ApLoMatches.length=0;
			}
			function ApLoRemoveHighlightsIn(element)
			{
				if(element && element.nodeType==1)
				{
					if(element.getAttribute("class")=="ApLoSearchHighlight")
					{
						var text=element.removeChild(element.firstChild);
						element.parentNode.insertBefore(text,element);
						element.parentNode.removeChild(element);
						
						return true;
					}
					else
					{
						var normalize=false;
						for(var i=element.childNodes.length-1;i>=0;i--)
						{
							if(ApLoRemoveHighlightsIn(element.childNodes[i]))
							{
								normalize=true;
							}
						}
						if(normalize)
						{
							element.normalize();
						}
					}
				}
			}
			function findHighlightedElementAtOrPreceding(element)
			{
				while(element)
				{
					if(element.nodeType==1
						&& element.getAttribute("class")=="ApLoSearchHighlight"
					)
					{
						break;
					}
					
					element=apLoElementPreceding(element);
				}
				
				return element;
			}
			function findHighlightedElementAtOrFollowing(element)
			{
				while(element)
				{
					if(element.nodeType==1
						&& element.getAttribute("class")=="ApLoSearchHighlight"
					)
					{
						break;
					}
					
					element=apLoElementFollowing(element);
				}
				
				return element;
			}
			function apLoElementPreceding(element) {
				
				if(element.childNodes.length>0)
				{
					return element.childNodes[element.childNodes.length-1];
				}
				
				if(element.previousSibling) return element.previousSibling;
				
				if(element.parentNode==element) return NULL;
				
				while(!element.parentNode.previousSibling)
				{
					element=element.parentNode;
				}
				
				return element.parentNode.previousSibling;
			}
			function apLoElementFollowing(element) {
				
				if(element.childNodes.length>0) return element.childNodes[0];
				if(element.nextSibling) return element.nextSibling;
				
				if(element.parentNode==element) return NULL;
				
				while(!element.parentNode.nextSibling)
				{
					element=element.parentNode;
				}
				
				return element.parentNode.nextSibling;
			}
			function ApLoAddHighlights(element,searchString)
			{
				if(!element) return false;
				if(element.nodeType==3)
				{
					// Text node
					while(true)
					{
						var value=element.nodeValue;
						var idx=value.toLowerCase().indexOf(searchString);
						
						if(idx<0) break;             
						
						var span=document.createElement("span");
						var text=document.createTextNode(value.substr(idx,searchString.length));
						span.appendChild(text);
						span.setAttribute("class","ApLoSearchHighlight");
						text=document.createTextNode(value.substr(idx+searchString.length));
						element.deleteData(idx,value.length-idx);
						var next=element.nextSibling;
						element.parentNode.insertBefore(span,next);
						element.parentNode.insertBefore(text,next);
						element=text;
						ApLoMatches.push(span);
					}
				}
				else if(element.nodeType==1)
				{
					// Element node
					if(element.style.display!="none" && element.nodeName.toLowerCase()!='select')
					{
						for(var i=element.childNodes.length-1;i>=0;i--)
						{
							ApLoAddHighlights(element.childNodes[i],searchString);
						}
					}
				}
			}
			function ApLoFindPrevious()
			{
				var selectedElement=apLoGetSelectedNode(true);
				
				if(!selectedElement)
				{
					if(AploMatches.length>0)
					{
						apLoSetSelectedMatch(AploMatches[AploMatches.length-1]);
					}
					
					return;
				}
				
				var element=findHighlightedElementAtOrPreceding(selectedElement);
				
				if(element==selectedElement)
				{
					element=apLoElementPreceding(selectedElement);
					element=findHighlightedElementAtOrPreceding(element);
				}
				
				apLoSetSelectedMatch(element);				
			}
			function ApLoFindNext()
			{
				var selectedElement=apLoGetSelectedNode(true);
				
				if(!selectedElement)
				{
					if(AploMatches.length>0)
					{
						apLoSetSelectedMatch(AploMatches[0]);
					}
					
					return;
				}
				
				var element=findHighlightedElementAtOrFollowing(selectedElement);
				
				if(element==selectedElement)
				{
					element=apLoElementFollowing(selectedElement);
					element=findHighlightedElementAtOrFollowing(element);
				}
				
				apLoSetSelectedMatch(element);				
			}
			function apLoGetSelectedNode()
			{
		        var	selection=window.getSelection();
		        if(selection.rangeCount<=0) return null;
				
				return selection.getRangeAt(0).startContainer;
			}
			function getSelectionBoundaryElement(isStart) {
			    var range, sel, container;
			    if (document.selection) {
			        range = document.selection.createRange();
			        range.collapse(isStart);
			        return range.parentElement();
			    } else {
			        sel = window.getSelection();
			        if (sel.getRangeAt) {
			            if (sel.rangeCount > 0) {
			                range = sel.getRangeAt(0);
			            }
			        } else {
			            // Old WebKit
			            range = document.createRange();
			            range.setStart(sel.anchorNode, sel.anchorOffset);
			            range.setEnd(sel.focusNode, sel.focusOffset);

			            // Handle the case when the selection was selected backwards (from the end to the start in the document)
			            if (range.collapsed !== sel.isCollapsed) {
			                range.setStart(sel.focusNode, sel.focusOffset);
			                range.setEnd(sel.anchorNode, sel.anchorOffset);
			            }
			       }

			        if (range) {
			           container = range[isStart ? "startContainer" : "endContainer"];

			           // Check if the container is a text node and return its parent if so
			           return container.nodeType === 3 ? container.parentNode : container;
			        }   
			    }
			}
			function apLoSetSelectedMatch(element)
			{
				if(ApLoSelectedMatch)
				{
					ApLoSelectedMatch.setAttribute("class","ApLoSearchHighlight");
				}
				
				if(element)
				{
					apLoSelectTextInElement(element);
					element.setAttribute("class","ApLoSearchSelected");
					// ApLoMatches[idx].scrollIntoView(true);
					
					// Note: Obj-C code will take care of the scrolling
				}
				
				ApLoSelectedMatch=element;
			}
			function apLoSelectTextInElement(element) {
				
				var selection=window.getSelection();
				var range=document.createRange();
				range.selectNode(element);
				selection.removeAllRanges();
				selection.addRange(range);
			}
		</script>
	</head>
	<body>
		<div class="document">
			The quick brown fox...  <a href="http://www.bitart.com/">www.bitart.com</a>
		</div>
	</body>
</html>
